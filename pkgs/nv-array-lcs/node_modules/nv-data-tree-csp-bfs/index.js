const gn=require("nv-data-tree-csp-gen"),{FLAG_DICT}=require("nv-data-tree-actdef"),{iflet}=require("nv-facutil-basic"),_0=Array.from,__ME={$gen_des_lyr:function*(_,e,n,r,l,t,s,f,i){let d=[s[0]];for(;0<d.length;)yield d,d=_0(gn.$nlyr(e,n,d))}},_1=__ME.$gen_des_lyr;__ME.$gen_lyr=function*(_,e,n,r,l,t,s,f,i){s=gn.lst0(gn.$ance(r,s[0]),s[0]);yield*_1(_,e,n,r,l,t,[s],f,i)};const _2=__ME.$gen_lyr;__ME.$des_lyrs_=(_,e,n,r,l,t,s,f,i)=>_0(_1(_,e,n,r,l,t,s,f,i)),__ME.$lyrs_=(_,e,n,r,l,t,s,f,i)=>_0(_2(_,e,n,r,l,t,s,f,i)),__ME.$lst_des_lyr_=(_,e,n,r,l,t,s,f,i)=>gn.lst0(_1(_,e,n,r,l,t,s,f,i),s[0]),__ME.$lst_lyr_=(_,e,n,r,l,t,s,f,i)=>{s=gn.lst0(gn.$ance(r,s[0]),s[0]);return gn.lst0(_2(_,e,n,r,l,t,[s],f,i),s)},__ME.$own_lyr_=(_,e,n,r,l,t,s,f,i)=>{f=_2(_,e,n,r,l,t,s,f,i),i=gn.lst0(gn.$ance(r,s[0]),s[0]),i=gn.dist_after(gn.$ance(r,s[0]),s[0],i);return gn.which(f,i)};const _3=__ME.$own_lyr_;__ME.$plyr_=(_,e,n,r,l,t,s,f,i)=>{s=r[s[0]];return 0===s?[]:_3(_,e,n,r,l,t,[s],f,i)},__ME.$bfs_des_next=(_,e,n,r,l,t,s,f,i)=>{var d=s[1],y=gn.dist_after(gn.$ance(r,s[0]),s[0],d);if(y===1/0)return[0,void 0];let $=[d],g=0;for(;0<$.length&&g!==y;)$=_0(gn.$nlyr(e,n,$)),g+=1;let E;for(E=0;E<$.length&&$[E]!==s[0];E++);let M;return E===$.length-1?($=_0(gn.$nlyr(e,n,$)),0===$.length?[0,void 0]:(M=1===$.length?FLAG_DICT.lyrbst:FLAG_DICT.lyrfst,[$[0],M])):E===$.length-2?[$[$.length-1],FLAG_DICT.lyrlst]:[$[E+1],FLAG_DICT.lyrmid]};const _bfs_step=(_,e,n,r,l,t,s,f,i,d)=>_(e,n,r,l,t,s,[f[0],gn.lst0(gn.$ance(l,f[0]),f[0])],i,d);__ME.$bfs_next_=(_,e,n,r,l,t,s,f,i)=>_bfs_step(__ME.$bfs_des_next,_,e,n,r,l,t,s,f,i),__ME.$bfs_des_prev=(_,e,n,r,l,t,s,f,i)=>{var d=s[1];if(d===s[0])return[0,FLAG_DICT.lyrbst];var y=gn.dist_after(gn.$ance(r,s[0]),s[0],d);if(y===1/0)return[0,void 0];let $=[d],g=[],E=0;for(;0<$.length&&E!==y;)g=$,$=_0(gn.$nlyr(e,n,$)),E+=1;let M;for(M=0;M<$.length&&$[M]!==s[0];M++);let b;return 0===M?($=g,0===$.length||(b=1===$.length?FLAG_DICT.lyrbst:FLAG_DICT.lyrlst),[$[$.length-1],b]):1===M?[$[0],FLAG_DICT.lyrfst]:[$[M-1],FLAG_DICT.lyrmid]},__ME.$bfs_prev_=(_,e,n,r,l,t,s,f,i)=>_bfs_step(__ME.$bfs_des_prev,_,e,n,r,l,t,s,f,i),__ME.$gen_des_bfs=function*(_,e,n,r,l,t,s,f,i){let d=[s[0]];for(yield[s[0],FLAG_DICT.lyrbst];0<d.length;)if(d=_0(gn.$nlyr(e,n,d)),0!==d.length)if(1===d.length)yield[d[0],FLAG_DICT.lyrbst];else{yield[d[0],FLAG_DICT.lyrfst];for(let _=1;_<d.length-1;_++)yield[d[_],FLAG_DICT.lyrmid];yield[d[d.length-1],FLAG_DICT.lyrlst]}};const _6=__ME.$gen_des_bfs;__ME.$gen_bfs=(_,e,n,r,l,t,s,f,i)=>_6(_,e,n,r,l,t,[gn.lst0(gn.$ance(r,s[0]),s[0])],f,i);const _5=__ME.$gen_bfs;__ME.$bfs_=(_,e,n,r,l,t,s,f,i)=>_0(_5(_,e,n,r,l,t,s,f,i)),__ME.$des_bfs_=(_,e,n,r,l,t,s,f,i)=>_0(_6(_,e,n,r,l,t,s,f,i)),__ME.$some_des_lyrs=(_,e,n,r,l,t,s,f,i)=>gn.some(_1(_,e,n,r,l,t,s,f,i),f),__ME.$some_lyrs=(_,e,n,r,l,t,s,f,i)=>gn.some(_2(_,e,n,r,l,t,s,f,i),f),__ME.$des_lyr=(_,e,n,r,l,t,s,f,i)=>gn.which(_1(_,e,n,r,l,t,s,f,i),f[0]),__ME.$lyr=(_,e,n,r,l,t,s,f,i)=>gn.which(_2(_,e,n,r,l,t,s,f,i),f[0]),__ME.$des_own_lyr=(_,e,n,r,l,t,s,f,i)=>{var d=s[1],s=gn.dist_after(gn.$ance(r,s[0]),s[0],d);if(s===1/0)return[];i=_1(_,e,n,r,l,t,[d],f,i);return gn.which(i,s)};const _4=__ME.$des_own_lyr;__ME.$des_plyr=(_,e,n,r,l,t,s,f,i)=>{var d=r[s[0]];return 0===d?[]:_4(_,e,n,r,l,t,[d,s[1]],f,i)},__ME.$breadth_=(_,e,n,r,l,t,s,f,i)=>_3(_,e,n,r,l,t,s,f,i).indexOf(s[0]),__ME.$pbreadth_=(_,e,n,r,l,t,s,f,i)=>__ME.$plyr_(_,e,n,r,l,t,s,f,i).indexOf(r[s[0]]),__ME.$des_breadth=(_,e,n,r,l,t,s,f,i)=>_4(_,e,n,r,l,t,s,f,i).indexOf(s[0]),__ME.$des_pbreadth=(_,e,n,r,l,t,s,f,i)=>__ME.$des_plyr(_,e,n,r,l,t,s,f,i).indexOf(r[s[0]]);const _is_lyr_fst=(_,e,n,r,l,t,s,f,i,d)=>{return _(e,n,r,l,t,s,f,i,d)[0]===f[0]},_is_lyr_lst=(_,e,n,r,l,t,s,f,i,d)=>{d=_(e,n,r,l,t,s,f,i,d);return d[d.length-1]===f[0]},_is_lyr_bst=(_,e,n,r,l,t,s,f,i,d,y)=>_(n,r,l,t,s,f,i,d,y)&&e(n,r,l,t,s,f,i,d,y);__ME.$is_lyr_fst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_fst(_3,_,e,n,r,l,t,s,f,i),__ME.$is_lyr_lst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_lst(_3,_,e,n,r,l,t,s,f,i),__ME.$is_lyr_bst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_bst(__ME.$is_lyr_fst,__ME.$is_lyr_lst,_,e,n,r,l,t,s,f,i),__ME.$is_des_lyr_fst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_fst(_4,_,e,n,r,l,t,s,f,i),__ME.$is_des_lyr_lst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_lst(_4,_,e,n,r,l,t,s,f,i),__ME.$is_des_lyr_bst=(_,e,n,r,l,t,s,f,i)=>_is_lyr_bst(__ME.$is_des_lyr_fst,__ME.$is_des_lyr_lst,_,e,n,r,l,t,s,f,i);function*_gen_lyr_next(_,e,n,r,l,t,s,f,i,d){let y=_(e,n,r,l,t,s,f,i,d);f=y.indexOf(f[0]);if(!(f<0)&&f!==y.length-1)for(var $ of y.slice(f))yield $}__ME.$gen_lyr_next=(_,e,n,r,l,t,s,f,i)=>_gen_lyr_next(_3,_,e,n,r,l,t,s,f,i),__ME.$gen_des_lyr_next=(_,e,n,r,l,t,s,f,i)=>_gen_lyr_next(_4,_,e,n,r,l,t,s,f,i);function*_gen_lyr_prev(_,e,n,r,l,t,s,f,i,d){let y=_(e,n,r,l,t,s,f,i,d);f=y.indexOf(f[0]);if(0<f){y.slice(f);for(let _=f-1;-1<_;_--)yield y[_]}}function _bfs_index(_,e,n,r,l,t,s,f,i,d,y,$,g){if(!r(y[0]))return-1;if(y[1]===y[0])return 0;var E=_?[y[1],y[0]]:y,M=e(l,t,s,f,i,d,E,$,g),M=e(l,t,s,f,i,d,E,$,g);let b=-1;if(1!==_||gn.of(gn.$ance(f,y[0]),y[1]))for(var[a,o]of M){if(n(a,y[0])){b+=1;break}r(a)&&(b+=1)}else;return b}__ME.$gen_lyr_prev=(_,e,n,r,l,t,s,f,i)=>_gen_lyr_prev(_3,_,e,n,r,l,t,s,f,i),__ME.$gen_des_lyr_prev=(_,e,n,r,l,t,s,f,i)=>_gen_lyr_prev(_4,_,e,n,r,l,t,s,f,i),__ME.$lyr_next_=(_,e,n,r,l,t,s,f,i)=>{let d=_3(_,e,n,r,l,t,s,f,i);s=d.indexOf(s[0]);return iflet(s<0,0,s===d.length-1,0,d[s+1])},__ME.$lyr_prev_=(_,e,n,r,l,t,s,f,i)=>{let d=_3(_,e,n,r,l,t,s,f,i);s=d.indexOf(s[0]);return iflet(s<0,0,0===s,0,d[s-1])},__ME.$des_lyr_next=(_,e,n,r,l,t,s,f,i)=>{let d=_4(_,e,n,r,l,t,s,f,i);s=d.indexOf(s[0]);return iflet(s<0,0,s===d.length-1,0,d[s+1])},__ME.$des_lyr_prev=(_,e,n,r,l,t,s,f,i)=>{let d=_4(_,e,n,r,l,t,s,f,i);s=d.indexOf(s[0]);return iflet(s<0,0,0===s,0,d[s-1])},__ME.$bfs_index_=(_,e,n,r,l,t,s,f,i)=>_bfs_index(0,_5,(_,e)=>_===e,_=>!0,_,e,n,r,l,t,s,f,i),__ME.$bfs_leaf_index_=(_,n,e,r,l,t,s,f,i)=>_bfs_index(0,_5,(_,e)=>_===e&&0===n[_],_=>0===n[_],_,n,e,r,l,t,s,f,i),__ME.$bfs_nonleaf_index_=(_,n,e,r,l,t,s,f,i)=>_bfs_index(0,_5,(_,e)=>_===e&&0!==n[_],_=>0!==n[_],_,n,e,r,l,t,s,f,i),__ME.$bfs_des_index=(_,e,n,r,l,t,s,f,i)=>_bfs_index(1,_6,(_,e)=>_===e,_=>!0,_,e,n,r,l,t,s,f,i),__ME.$bfs_des_leaf_index=(_,n,e,r,l,t,s,f,i)=>_bfs_index(1,_6,(_,e)=>_===e&&0===n[_],_=>0===n[_],_,n,e,r,l,t,s,f,i),__ME.$bfs_des_nonleaf_index=(_,n,e,r,l,t,s,f,i)=>_bfs_index(1,_6,(_,e)=>_===e&&0!==n[_],_=>0!==n[_],_,n,e,r,l,t,s,f,i),__ME.$des_bpl=(_,e,n,r,l,t,s,f,i)=>{let d=[];var y=s[1];let $=_1(_,e,n,r,l,t,[y],f,i);r=gn.$ance(r,s[0]);let g=_0(r);if(g.includes(y)||s[0]===y){g.reverse(),g.push(s[0]),g=g.slice(g.indexOf(y));for(var E of g){let _=$.next().value;E=_.indexOf(E);d.push(E)}return d}return[-1]},__ME.$bpl_=(_,e,n,r,l,t,s,f,i)=>{var d=gn.lst0(gn.$ance(r,s[0]),s[0]);return __ME.$des_bpl(_,e,n,r,l,t,[s[0],d],f,i)},module.exports=__ME;